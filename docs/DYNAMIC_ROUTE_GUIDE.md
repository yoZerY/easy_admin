# åŠ¨æ€è·¯ç”±åˆå¹¶æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†**åç«¯è·¯ç”±ä¸æœ¬åœ°è·¯ç”±çš„æ™ºèƒ½åˆå¹¶**æœºåˆ¶ï¼Œæ”¯æŒï¼š

- âœ… åç«¯è¿”å›èœå•æ•°æ®
- âœ… æœ¬åœ°å®šä¹‰è·¯ç”±ç»„ä»¶
- âœ… æ™ºèƒ½åˆå¹¶å’Œè¿‡æ»¤
- âœ… æƒé™æ§åˆ¶
- âœ… åŠ¨æ€æ˜¾ç¤º/éšè—

## ğŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç™»å½•    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è·å–åç«¯èœå•æ•°æ®          â”‚
â”‚    è¿”å›ç”¨æˆ·å¯è®¿é—®çš„èœå•åˆ—è¡¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è·å–æœ¬åœ°é™æ€è·¯ç”±          â”‚
â”‚    ä» router è·å–æ‰€æœ‰è·¯ç”±    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆå¹¶è·¯ç”±                  â”‚
â”‚    - ä»¥æœ¬åœ°è·¯ç”±ä¸ºä¸»          â”‚
â”‚    - åç«¯èœå•æ§åˆ¶æ˜¾ç¤º/éšè—   â”‚
â”‚    - åˆå¹¶ meta ä¿¡æ¯          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è¿‡æ»¤å’Œæ’åº                â”‚
â”‚    - æƒé™è¿‡æ»¤                â”‚
â”‚    - æŒ‰ rank æ’åº            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ›´æ–°ä¾§è¾¹æ èœå•            â”‚
â”‚    æ˜¾ç¤ºåˆå¹¶åçš„è·¯ç”±          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ router.ts        # è·¯ç”±çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ menu.ts          # èœå•çŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ user.ts          # ç”¨æˆ·çŠ¶æ€ç®¡ç†
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ route.ts             # è·¯ç”±å·¥å…·å‡½æ•°
â”œâ”€â”€ router/
â”‚   â”œâ”€â”€ index.ts             # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ index.ts         # è·¯ç”±å¯¼å‡º
â”‚       â””â”€â”€ modules/         # è·¯ç”±æ¨¡å—
â””â”€â”€ layouts/
    â””â”€â”€ components/
        â””â”€â”€ SideBar/
            â””â”€â”€ VerticalSide.vue  # ä¾§è¾¹æ ï¼ˆä½¿ç”¨åˆå¹¶åçš„è·¯ç”±ï¼‰
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. è·¯ç”±åˆå¹¶ç­–ç•¥

**ç­–ç•¥**ï¼šä»¥æœ¬åœ°è·¯ç”±ä¸ºä¸»ï¼Œåç«¯èœå•ç”¨äºæ§åˆ¶æ˜¾ç¤º/éšè—

```typescript
// src/utils/route.ts
export function mergeRoutesWithMenus(
  localRoutes: RouteRecordRaw[],
  backendMenus: MenuItem[]
): RouteRecordRaw[] {
  // åˆ›å»ºåç«¯èœå•è·¯å¾„æ˜ å°„
  const menuPathMap = new Map<string, MenuItem>()
  backendMenus.forEach((menu) => {
    menuPathMap.set(menu.path, menu)
  })

  // è¿‡æ»¤æœ¬åœ°è·¯ç”±ï¼Œåªä¿ç•™åç«¯è¿”å›çš„èœå•å¯¹åº”çš„è·¯ç”±
  const mergedRoutes = localRoutes.filter((route) => {
    const backendMenu = menuPathMap.get(route.path)

    // å¦‚æœåç«¯æ²¡æœ‰è¿”å›è¿™ä¸ªèœå•ï¼Œåˆ™éšè—
    if (!backendMenu) {
      return false
    }

    // åˆå¹¶ meta ä¿¡æ¯ï¼ˆåç«¯ä¼˜å…ˆï¼‰
    if (route.meta && backendMenu.meta) {
      route.meta = {
        ...route.meta,
        ...backendMenu.meta
      }
    }

    return true
  })

  return mergedRoutes
}
```

### 2. è·¯ç”± Store

```typescript
// src/stores/modules/router.ts
export const useRouterStore = defineStore('router', {
  state: () => ({
    routes: [], // æœ¬åœ°è·¯ç”±
    mergedRoutes: [], // åˆå¹¶åçš„è·¯ç”±
    isRoutesAdded: false // æ˜¯å¦å·²æ·»åŠ è·¯ç”±
  }),

  actions: {
    async generateRoutes(menus: MenuItem[]) {
      // 1. è·å–æœ¬åœ°è·¯ç”±
      const localRoutes = router.getRoutes()

      // 2. åˆå¹¶è·¯ç”±
      const mergedRoutes = mergeRoutesWithMenus(localRoutes, menus)

      // 3. æ’åº
      const sortedRoutes = sortRoutesByRank(mergedRoutes)

      // 4. ä¿å­˜
      this.mergedRoutes = sortedRoutes
      this.isRoutesAdded = true
    }
  }
})
```

### 3. ä¾§è¾¹æ ä½¿ç”¨

```vue
<!-- src/layouts/components/SideBar/VerticalSide.vue -->
<script setup>
import { useRouterStore } from '@/stores/modules/router'

const routerStore = useRouterStore()

// ä½¿ç”¨åˆå¹¶åçš„è·¯ç”±
const visibleRoutes = computed(() => {
  const mergedRoutes = routerStore.getMergedRoutes

  if (mergedRoutes && mergedRoutes.length > 0) {
    // ä½¿ç”¨åˆå¹¶åçš„è·¯ç”±
    return mergedRoutes.filter((item) => {
      // æƒé™è¿‡æ»¤
      if (item.meta?.roles && !hasRole(item.meta.roles)) return false
      if (item.meta?.auths && !hasAuth(item.meta.auths)) return false
      return true
    })
  }

  // å¦åˆ™ä½¿ç”¨åŸå§‹èœå•
  return menuStore.getMenus
})
</script>
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åç«¯è¿”å›èœå•æ•°æ®

```json
[
  {
    "path": "/",
    "name": "Home",
    "meta": {
      "icon": "ri:home-4-line",
      "title": "é¦–é¡µ",
      "rank": 1,
      "showLink": true
    }
  },
  {
    "path": "/system",
    "name": "System",
    "meta": {
      "icon": "ri:settings-3-line",
      "title": "ç³»ç»Ÿç®¡ç†",
      "rank": 2,
      "showLink": true
    }
  }
]
```

### 2. æœ¬åœ°è·¯ç”±å®šä¹‰

```typescript
// src/router/routes/modules/home.ts
export default {
  path: '/',
  name: 'Home',
  component: Layout,
  redirect: '/welcome',
  meta: {
    icon: 'ri:home-4-line',
    title: 'é¦–é¡µ',
    rank: 1
  },
  children: [
    {
      path: '/welcome',
      name: 'Welcome',
      component: () => import('@/views/welcome/index.vue'),
      meta: {
        title: 'æ¬¢è¿é¡µ'
      }
    }
  ]
}
```

### 3. åˆå¹¶ç»“æœ

```typescript
// åˆå¹¶åçš„è·¯ç”±
[
  {
    path: '/',
    name: 'Home',
    component: Layout,
    redirect: '/welcome',
    meta: {
      icon: 'ri:home-4-line',
      title: 'é¦–é¡µ',
      rank: 1,
      showLink: true  // æ¥è‡ªåç«¯
    },
    children: [...]
  }
]
```

## ğŸ”§ é…ç½®è¯´æ˜

### 1. è·¯ç”± Meta é…ç½®

| å­—æ®µ     | ç±»å‹     | è¯´æ˜     | æ¥æº     |
| -------- | -------- | -------- | -------- |
| title    | string   | èœå•æ ‡é¢˜ | åç«¯ä¼˜å…ˆ |
| icon     | string   | èœå•å›¾æ ‡ | åç«¯ä¼˜å…ˆ |
| rank     | number   | æ’åº     | åç«¯ä¼˜å…ˆ |
| showLink | boolean  | æ˜¯å¦æ˜¾ç¤º | åç«¯æ§åˆ¶ |
| roles    | string[] | è§’è‰²æƒé™ | æœ¬åœ°å®šä¹‰ |
| auths    | string[] | æ“ä½œæƒé™ | æœ¬åœ°å®šä¹‰ |

### 2. åˆå¹¶è§„åˆ™

1. **è·¯å¾„åŒ¹é…**ï¼šæ ¹æ® `path` åŒ¹é…æœ¬åœ°è·¯ç”±å’Œåç«¯èœå•
2. **Meta åˆå¹¶**ï¼šåç«¯ meta ä¼˜å…ˆçº§é«˜äºæœ¬åœ° meta
3. **æ˜¾ç¤ºæ§åˆ¶**ï¼šåç«¯æœªè¿”å›çš„è·¯ç”±å°†è¢«éšè—
4. **ç»„ä»¶ä¿ç•™**ï¼šæœ¬åœ°å®šä¹‰çš„ç»„ä»¶ä¸ä¼šè¢«è¦†ç›–

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æœ¬åœ°è·¯ç”±å®šä¹‰

```typescript
// âœ… æ¨èï¼šå®Œæ•´å®šä¹‰è·¯ç”±
export default {
  path: '/system',
  name: 'System',
  component: Layout,
  redirect: '/system/user',
  meta: {
    icon: 'ri:settings-3-line',
    title: 'ç³»ç»Ÿç®¡ç†',
    rank: 2,
    roles: ['admin'],  // æœ¬åœ°å®šä¹‰æƒé™
    auths: ['system:view']
  },
  children: [...]
}

// âŒ ä¸æ¨èï¼šä¾èµ–åç«¯è¿”å›ç»„ä»¶è·¯å¾„
// ç»„ä»¶åº”è¯¥åœ¨æœ¬åœ°å®šä¹‰ï¼Œåç«¯åªè¿”å›èœå•æ•°æ®
```

### 2. åç«¯èœå•æ•°æ®

```json
// âœ… æ¨èï¼šåªè¿”å›èœå•æ˜¾ç¤ºä¿¡æ¯
{
  "path": "/system",
  "name": "System",
  "meta": {
    "icon": "ri:settings-3-line",
    "title": "ç³»ç»Ÿç®¡ç†",
    "rank": 2,
    "showLink": true
  }
}

// âŒ ä¸æ¨èï¼šè¿”å›ç»„ä»¶è·¯å¾„
// ç»„ä»¶è·¯å¾„åº”è¯¥åœ¨å‰ç«¯å®šä¹‰ï¼Œä¸åº”è¯¥ç”±åç«¯æ§åˆ¶
```

### 3. æƒé™æ§åˆ¶

```typescript
// âœ… æ¨èï¼šåœ¨æœ¬åœ°è·¯ç”±ä¸­å®šä¹‰æƒé™
meta: {
  roles: ['admin', 'editor'],
  auths: ['system:user:list']
}

// åç«¯åªè¿”å›ç”¨æˆ·å¯è®¿é—®çš„èœå•åˆ—è¡¨
// å‰ç«¯æ ¹æ®æƒé™è¿‡æ»¤è·¯ç”±
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šä¸åŒè§’è‰²çœ‹åˆ°ä¸åŒèœå•

```typescript
// ç®¡ç†å‘˜ç™»å½•
// åç«¯è¿”å›ï¼š['/', '/system', '/data', '/monitor']
// ä¾§è¾¹æ æ˜¾ç¤ºï¼šé¦–é¡µã€ç³»ç»Ÿç®¡ç†ã€æ•°æ®ç®¡ç†ã€ç³»ç»Ÿç›‘æ§

// æ™®é€šç”¨æˆ·ç™»å½•
// åç«¯è¿”å›ï¼š['/', '/data']
// ä¾§è¾¹æ æ˜¾ç¤ºï¼šé¦–é¡µã€æ•°æ®ç®¡ç†
```

### åœºæ™¯ 2ï¼šåŠ¨æ€æ§åˆ¶èœå•æ˜¾ç¤º

```typescript
// åç«¯å¯ä»¥åŠ¨æ€æ§åˆ¶èœå•çš„æ˜¾ç¤º/éšè—
{
  "path": "/system",
  "meta": {
    "showLink": false  // éšè—æ­¤èœå•
  }
}
```

### åœºæ™¯ 3ï¼šè‡ªå®šä¹‰èœå•é¡ºåº

```typescript
// åç«¯å¯ä»¥è‡ªå®šä¹‰èœå•é¡ºåº
{
  "path": "/system",
  "meta": {
    "rank": 1  // è°ƒæ•´æ’åº
  }
}
```

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹åˆå¹¶è¿‡ç¨‹

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œç™»å½•æ—¶ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š

```
ğŸ”„ å¼€å§‹ç”ŸæˆåŠ¨æ€è·¯ç”±...
ğŸ“‹ åç«¯èœå•æ•°æ®: [...]
ğŸ“¦ æœ¬åœ°é™æ€è·¯ç”±: 20 ä¸ª
ğŸ”„ å¼€å§‹åˆå¹¶è·¯ç”±...
ğŸ“¦ æœ¬åœ°è·¯ç”±æ•°é‡: 20
ğŸ“‹ åç«¯èœå•æ•°é‡: 7
âœ… è·¯ç”± / åˆå¹¶æˆåŠŸ
âœ… è·¯ç”± /system åˆå¹¶æˆåŠŸ
âš ï¸ è·¯ç”± /hidden åœ¨åç«¯èœå•ä¸­ä¸å­˜åœ¨ï¼Œå°†è¢«éšè—
âœ… è·¯ç”±åˆå¹¶å®Œæˆï¼Œæœ€ç»ˆè·¯ç”±æ•°: 7
```

### 2. æŸ¥çœ‹åˆå¹¶ç»“æœ

```typescript
import { useRouterStore } from '@/stores/modules/router'

const routerStore = useRouterStore()

// æŸ¥çœ‹åˆå¹¶åçš„è·¯ç”±
console.log('åˆå¹¶åçš„è·¯ç”±:', routerStore.getMergedRoutes)
```

### 3. æŸ¥çœ‹ä¾§è¾¹æ è·¯ç”±

```vue
<script setup>
const visibleRoutes = computed(() => {
  const routes = routerStore.getMergedRoutes
  console.log('ä¾§è¾¹æ è·¯ç”±:', routes)
  return routes
})
</script>
```

## ğŸ“Š å¯¹æ¯”è¯´æ˜

### ä¼ ç»Ÿæ–¹å¼ vs åˆå¹¶æ–¹å¼

| ç‰¹æ€§     | ä¼ ç»Ÿæ–¹å¼ | åˆå¹¶æ–¹å¼   |
| -------- | -------- | ---------- |
| è·¯ç”±å®šä¹‰ | å‰ç«¯å®šä¹‰ | å‰ç«¯å®šä¹‰   |
| èœå•æ•°æ® | å‰ç«¯å®šä¹‰ | åç«¯è¿”å›   |
| æƒé™æ§åˆ¶ | å‰ç«¯åˆ¤æ–­ | å‰åç«¯ç»“åˆ |
| åŠ¨æ€æ€§   | ä½       | é«˜         |
| å®‰å…¨æ€§   | ä¸­       | é«˜         |
| çµæ´»æ€§   | ä½       | é«˜         |

## ğŸ“ æ€»ç»“

é€šè¿‡è·¯ç”±åˆå¹¶æœºåˆ¶ï¼Œä½ å¯ä»¥ï¼š

1. âœ… **ä¿æŒå‰ç«¯è·¯ç”±å®Œæ•´æ€§**ï¼šç»„ä»¶åœ¨æœ¬åœ°å®šä¹‰ï¼Œä¸ä¾èµ–åç«¯
2. âœ… **åŠ¨æ€æ§åˆ¶èœå•æ˜¾ç¤º**ï¼šåç«¯è¿”å›ç”¨æˆ·å¯è®¿é—®çš„èœå•
3. âœ… **æ™ºèƒ½åˆå¹¶ Meta ä¿¡æ¯**ï¼šåç«¯å¯ä»¥è¦†ç›–éƒ¨åˆ†é…ç½®
4. âœ… **æƒé™ç²¾ç¡®æ§åˆ¶**ï¼šå‰åç«¯åŒé‡éªŒè¯
5. âœ… **æ˜“äºç»´æŠ¤**ï¼šå‰ç«¯è·¯ç”±å’Œåç«¯èœå•åˆ†ç¦»

ç°åœ¨ä½ å¯ä»¥ç™»å½•ç³»ç»Ÿï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œäº†è§£å®Œæ•´çš„è·¯ç”±åˆå¹¶è¿‡ç¨‹ï¼ğŸ‰
